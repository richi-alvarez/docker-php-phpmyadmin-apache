# abrir docker env de minikube
eval $(minikube docker-env)

# construir la imagen dentro de minikube
docker build -t apache-local:latest -f ./Dockerfile .

# volver al docker host original (opcional)
eval $(minikube docker-env -u)

minikube start --driver=docker
minikube addons enable storage-provisioner


kubectl get pods -w
kubectl apply -f ./k8s/dev-stack-pod.yaml
kubectl delete pod dev-stack-pod
kubectl describe pod dev-stack-pod
kubectl get pods -w
kubectl logs dev-stack-pod -c wordpress
kubectl logs dev-stack-pod -c phpmyadmin
kubectl get events --sort-by='.metadata.creationTimestamp'k


kubectl apply -f ./k8s/dev-stack-deployment.yam


ubectl apply -f ./k8s/dev-stack-services.yaml
kubectl get svc dev-stack-mysql dev-stack-local
kubectl port-forward svc/dev-stack-local 30080:80 (si necesitas acceso local adicional)

kubectl apply -f k8s/dev-stack-secrets.yaml
kubectl apply -f k8s/dev-stack-deployment.yaml
kubectl rollout restart deployment/dev-stack-deployment
kubectl describe secret dev-mysql-secret

kubectl rollout restart statefulset/dev-mysql

kubectl apply -f k8s/dev-stack-secrets.yaml
kubectl rollout restart statefulset/dev-mysql
kubectl apply -f k8s/dev-ingress.yaml

eval $(minikube docker-env)
docker build -t apache-local:latest -f ./Dockerfile .
eval $(minikube docker-env -u)
# recrear pods para que tomen la imagen existente
kubectl rollout restart deployment/dev-stack-deployment || kubectl delete pod -l app=dev-stack
kubectl get pods -w

kubectl exec -it <nombre-del-pod> -- /bin/bash

kubectl port-forward svc/<nombre-del-service> 8080:80
Luego abre http://localhost:8080 en tu navegador.

minikube service dev-stack-local --url
Luego abre http://192.168.58.2:30080

#Para montar una carpeta local (por ejemplo, www) como volumen en tu pod de Kubernetes, debes usar un volumen de tipo hostPat
minikube mount /home/epayco21/Escritorio/github/docker-php-phpmyadmin-apache/www:/mnt/www

#contenedor mysql
kubectl exec -it <nombre-del-pod> -- bash
kubectl exec -it dev-mysql-0 -- bash

#aplicar todo
kubectl apply -f ./k8s/.

#elimnar todo
kubectl delete -f ./k8s/.