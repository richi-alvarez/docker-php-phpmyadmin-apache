apiVersion: v1
kind: Pod
metadata:
  name: dev-stack-pod
  labels:
    app: dev-stack
spec:
  restartPolicy: Always
  containers:
    - name: mysql
      image: mysql:5.7
      env:
        - name: MYSQL_ROOT_PASSWORD
          value: "test"
        - name: MYSQL_DATABASE
          value: "wordpress"
        - name: MYSQL_PASSWORD
          value: "test"
      ports:
        - name: mysql
          containerPort: 3306
      volumeMounts:
        - name: mysql-data
          mountPath: /var/lib/mysql
      readinessProbe:
        exec:
          command:
            - sh
            - -c
            - mysqladmin ping -h 127.0.0.1 -uroot -ptest
        initialDelaySeconds: 10
        periodSeconds: 10

    - name: local
      image: apache-local:latest
      imagePullPolicy: Never
      env:
        - name: XDEBUG_CLIENT_HOST
          value: "172.17.0.1"
        - name: XDEBUG_CLIENT_PORT
          value: "9004"
        - name: PHP_IDE_CONFIG
          value: "serverName=local-server"
      ports:
        - name: local-http
          containerPort: 80
      volumeMounts:
        - name: www-data
          mountPath: /var/www/html
        - name: php-config
          mountPath: /usr/local/etc/php/conf.d
  volumes:
    - name: mysql-data
      emptyDir: {}
    - name: www-data
      emptyDir: {}
    - name: php-config
      emptyDir: {}